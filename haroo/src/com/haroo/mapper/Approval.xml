<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="com.haroo.mapper.ApprovalMapper">
	<cache />
	
	<!-- 결재문서 상신(저장) -->
	<insert id="insertApproval" parameterType="ApprovalVO" >
	  <selectKey keyProperty="apNo" resultType="int" order="BEFORE">
	    SELECT ap_seq.nextval FROM dual
	  </selectKey>
	  INSERT INTO approval 
	    VALUES(#{apNo}, #{foNo}, #{emNo}, #{apTitle}, #{apContent}, SYSDATE, #{apPublic}, 0)
	</insert>
	
	 <!-- 휴가신청서 저장 -->
  <insert id="insertLeave" parameterType="LeaveVO" >
    INSERT INTO leave
      VALUES(#{apNo}, #{foNo}, #{emNo}, #{leTitle}, #{leKind}, TO_DATE(#{leStart}, 'YYYY/MM/DD'), 
      TO_DATE(#{leEnd}, 'YYYY/MM/DD'), SYSDATE, 0, #{daNo})
  </insert>
  
  <!-- 품의목록 저장 -->
  <insert id="insertExpenseList" parameterType="ExpenseListVO">
    INSERT INTO expense_list
      VALUES(#{elNo}, #{apNo}, #{elItem}, #{elQuantity}, #{elPrice}, #{elTotal})
  </insert>
	
	<!-- 결재선 저장 -->
	<insert id="insertApprovalLine" parameterType="ApprovalLineVO">
	  INSERT INTO approval_line
	    VALUES(#{apNo}, #{alNo}, #{alOrder}, 0, null, null)
	</insert>
	
	<!-- 상신-진행 문서 리스트 불러오기 -->
	<select id="listProcess" parameterType="int" resultType="ApprovalVO">
	  SELECT * FROM approval WHERE em_no = #{emNo} AND ap_status = 0
	</select>
	
	<!-- 결재선 사원 리스트 불러오기 -->
	<select id="listLineEmployee" resultType="ApLineEmpVO">
	  SELECT em_no, em_name, po_name, de_name, e.po_no FROM employee e JOIN position p
	  ON e.po_no = p.po_no JOIN department d 
	  ON e.de_no = d.de_no
	  order by de_name, po_no
	</select>

</mapper>
